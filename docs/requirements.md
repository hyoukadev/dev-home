# 需求文档：基于 Nushell 的配置软链管理系统

## 1. 背景
项目原有的配置文件符号链接（Symlink）生成逻辑由 Rust 实现 (`src/main.rs`)。为了提高配置的可维护性，降低修改门槛（无需编译 Rust 代码），并充分利用项目中已引入的 Nushell 工具链，现计划移除 Rust 实现，改用 Nushell 脚本来实现跨平台的配置同步与链接管理。

## 2. 目标
构建一套轻量级、模块化且跨平台的配置管理脚本系统，使得添加新应用配置或修改现有路径映射变得简单直观。

## 3. 功能需求

### 3.1 核心功能
*   **移除 Rust 和 Just 依赖**：完全废除 `src/` 目录、`Cargo.toml`、`pathes.toml` 以及 `justfile`，由 Nushell 脚本接管所有逻辑。
*   **创建符号链接**：能够将仓库内的配置文件或目录链接到操作系统的标准配置路径（如 `~/.config` 或 `%APPDATA%`）。
*   **支持目录与文件**：支持对整个文件夹（如 `nvim/`）或单个文件（如 `.gitconfig`）创建链接。
*   **备份机制**：当目标路径已存在实体文件（非链接）时，自动将其重命名备份（如 `.bak`），避免数据丢失。
*   **幂等性**：
    *   如果链接已正确存在，跳过操作。
    *   如果链接存在但指向错误，更新链接。
    *   多次运行脚本不应产生副作用。

### 3.2 跨平台兼容
*   **路径解析**：
    *   自动处理 Windows (`\`) 与 Unix (`/`) 的路径分隔符差异。
    *   动态获取系统标准路径（使用 `pathvar` 逻辑）：
        *   **Windows**: 使用 `%APPDATA%` (Roaming) 或 `%LOCALAPPDATA%`。
        *   **macOS**: 使用 `~/Library/Application Support` 或 `~/.config`。
        *   **Linux**: 遵循 XDG Base Directory 规范 (`~/.config`)。
*   **底层命令适配**：
    *   **Windows**: 使用 `mklink` (需处理文件与目录的区别 `mklink /D`)。
    *   **Unix**: 使用 `ln -s`。

### 3.3 模块化架构
*   每个应用（如 Helix, Nushell, Alacritty）在各自的目录下拥有独立的 `init.nu` 脚本。
*   `init.nu` 负责定义该应用特定的源路径和目标路径。
*   公共逻辑（路径获取、链接创建函数）抽取到 `nushell/modules/` 中复用。

### 3.4 统一入口
*   通过 Nushell 脚本（如 `task.nu`）提供简单的命令来一键安装所有配置及执行其他任务。
*   支持单独运行某个应用的配置脚本以便调试。

## 4. 非功能需求
*   **易用性**：新增一个应用配置时，只需复制现有模板并修改路径变量即可。
*   **可读性**：代码应清晰，并在执行过程中输出友好的日志（使用 Emoji 区分状态：✅ 成功, 🔄 更新, 📦 备份）。